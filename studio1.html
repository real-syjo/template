<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ocean AI</title>
    <meta name="description" content="Portfolio for world-renowned software engineer soyeon">
    <meta name="author" content="soyeon">

    <script src="https://kit.fontawesome.com/7ebfe642cb.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="studioStyle1.css"/>
    <script src="studio1.js" defer></script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@2.4.1/dist/email.min.js"> </script>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
</head>

<body>
    <section id="home">
      <div id="stage" class="shrink-wrap">

        
          <!-- ê¸°ì¡´ ì½˜í…ì¸  -->
        <div class="shrink-scale">
          <div class="your-panel">
            <div class="wrap">
                <!-- í•˜ë‹¨: ë„ë„› + ë²”ë¡€ -->
                <div class="card"  data-step="0">
                  <div class="main">
                    <div class="box" id="progressBox">
                      <div class="progress">
                        <div class="bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                          <div class="fill" id="chipProgress"></div>
                        </div>
                      </div>
                       <div class="percent" id="chipPercent">0%</div>
                    </div>

                   <div class="box" id="box">
                        <div class="slideshow-container">
                          <div class="slide">
                             ì•ì—ì„œ ì„ íƒí•œ ë°ì´í„°ë¥¼ í™œìš©í•  ìˆ˜ ìˆë„ë¡ ì „ì²˜ë¦¬ê°€ í•„ìš”í•´ìš”.
                          </div>

                          <!-- ë²„íŠ¼ -->
                          <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
                          <a class="next" onclick="plusSlides(1)">&#10095;</a>

                          <!-- ì  -->
                          <div class="dots">
                            <span class="dot" onclick="currentSTSlide(1)"></span>
                            <span class="dot" onclick="currentSlide(2)"></span>
                            <span class="dot" onclick="currentSlide(3)"></span>
                          </div>
                          
                        </div>
                
                        <div class="recommand" id="recommand"></div>
                            <button id="choiceBtn" >í•­ëª©ì„ íƒí•˜ê¸°</button>
                        </div>
                         
                       </div>     
                      </div> 
                    </div> 
                  </div>
                  </div> 
                </div>
            </div>
          </div>
  
    </div>
    </section>
<!-- Modal -->
<div id="choiceModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    
    <h2>í•­ëª© ì„ íƒ</h2>
    <div class="modal-boxes">
      <div class="box" data-key="box1">ë°•ìŠ¤ 1</div>
      <div class="box" data-key="box2">ë°•ìŠ¤ 2</div>
      <div class="box" data-key="box3">ë°•ìŠ¤ 3</div>
      <div class="box" data-key="box4">ë°•ìŠ¤ 4</div>
      <div class="box" data-key="box5">ë°•ìŠ¤ 5</div>
      <div class="box" data-key="box6">ë°•ìŠ¤ 6</div>
      <div class="box" data-key="box7">ë°•ìŠ¤ 7</div>
      <div class="box" data-key="box8">ë°•ìŠ¤ 8</div>
      <div class="box" data-key="box9">ë°•ìŠ¤ 9</div>
      <div class="box" data-key="box10">ë°•ìŠ¤ 10</div>
      <div class="box" data-key="box11">ë°•ìŠ¤ 11</div>
      <div class="box" data-key="box12">ë°•ìŠ¤ 12</div>
      <div class="box" data-key="box13">ë°•ìŠ¤ 13</div>
      <div class="box" data-key="box14">ë°•ìŠ¤ 14</div>
      <div class="box" data-key="box15">ë°•ìŠ¤ 15</div>
      <div class="box" data-key="box16">ë°•ìŠ¤ 16</div>
      <div class="box" data-key="box17">ë°•ìŠ¤ 17</div>
      <div class="box" data-key="box18">ë°•ìŠ¤ 18</div>
      <div class="box" data-key="box19">ë°•ìŠ¤ 19</div>
      <div class="box" data-key="box20">ë°•ìŠ¤ 20</div>
      <div class="box" data-key="box21">ë°•ìŠ¤ 21</div>
      <div class="box" data-key="box22">ë°•ìŠ¤ 22</div>
      <div class="box" data-key="box23">ë°•ìŠ¤ 23</div>
      <div class="box" data-key="box24">ë°•ìŠ¤ 24</div>
      <div class="box" data-key="box25">ë°•ìŠ¤ 25</div>
    </div>
  </div>
</div>
</body>
</html>

<script>
/* =================== ASK-WRAP ê¸°ë°˜ í”„ë¡œê·¸ë˜ìŠ¤ =================== */
/* êµ¬ê°„(ëˆˆê¸ˆ) ë‹¤ì‹œ ê·¸ë¦¬ê¸° */
function renderProgressTicksFromAskWraps() {
  const total = document.querySelectorAll('#recommand .ask-wrap').length || 0;
  const bar = document.querySelector('.progress .bar');
  if (!bar) return;

  let ticks = bar.querySelector('.ticks');
  if (!ticks) {
    ticks = document.createElement('div');
    ticks.className = 'ticks';
    bar.appendChild(ticks);
  }
  // ì´ Nê°œë©´ ëˆˆê¸ˆì€ N-1ê°œ
  ticks.innerHTML = '';
  for (let i = 1; i < total; i++) {
    const t = document.createElement('i');
    t.className = 'tick';
    t.style.left = (i * 100 / total) + '%';
    ticks.appendChild(t);
  }
}

/* ë°©ë¬¸(í´ë¦­)í•œ ask-wrap ìˆ˜ â†’ í”„ë¡œê·¸ë˜ìŠ¤ í­/í¼ì„¼íŠ¸ ê³„ì‚° */
function updateProgressFromAskWraps() {
  const total   = document.querySelectorAll('#recommand .ask-wrap').length || 0;
  const visited = document.querySelectorAll('#recommand .ask-wrap.visited').length || 0;
  const percent = total ? Math.round((visited / total) * 100) : 0;
  const clamped = Math.min(percent, 80);

  const fill  = document.getElementById('chipProgress');
  const label = document.getElementById('chipPercent');
  if (fill)  fill.style.width = clamped + '%';
  if (label) label.textContent = clamped + '%';

  // ë¶€ëª¨(1ë‹¨ê³„ ê²Œì´ì§€)ì— ì§„í–‰ë¥  ì „ë‹¬(í•„ìš” ì‹œ)
  try {
    window.parent?.postMessage({ type: 'IFRAME_STEP_PROGRESS', stepIndex: 1, percent }, '*');
  } catch (_) {}
}

function updateProgressFromInlineInputs() {
  const inputs = document.querySelectorAll('.inline-input.bind-input');
  if (!inputs.length) return;

  const total   = inputs.length;
  const filled  = Array.from(inputs).filter(inp => inp.value.trim() !== '').length;

  // âœ… ë¹„ìœ¨ëŒ€ë¡œ í¼ì„¼íŠ¸ ê³„ì‚° (ìµœëŒ€ 80%)
  const percent = total ? Math.round((filled / total) * 80) : 0;

  const fill  = document.getElementById('chipProgress');
  const label = document.getElementById('chipPercent');
  if (fill)  fill.style.width = percent + '%';
  if (label) label.textContent = percent + '%';

  // í•„ìš”í•˜ë‹¤ë©´ ë¶€ëª¨ ë‹¨ê³„ ê²Œì´ì§€ì—ë„ ì „ë‹¬
  try {
    window.parent?.postMessage({
      type: 'IFRAME_STEP_PROGRESS',
      stepIndex: 1,
      percent
    }, '*');
  } catch (_) {}
}

document.addEventListener('input', (e) => {
  if (e.target.classList.contains('inline-input') && e.target.classList.contains('bind-input')) {
    updateProgressFromInlineInputs();
  }
});


/* ì²« í´ë¦­ë§Œ ì¹´ìš´íŠ¸: ask-wrapì„ í´ë¦­í•˜ë©´ visited í‘œì‹œ + ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ */
document.getElementById('recommand')?.addEventListener('click', (e) => {
  const wrap = e.target.closest('.ask-wrap');
  if (!wrap) return;

  // ì²˜ìŒ í´ë¦­í•œ ì¹´ë“œë§Œ visited ë¶€ì—¬
  if (!wrap.classList.contains('visited')) {
    wrap.classList.add('visited');
    updateProgressFromAskWraps();
  }
});

/* ask-wrap ì¶”ê°€/ì‚­ì œë˜ë©´ êµ¬ê°„/ì§„í–‰ë¥  ì¬ê³„ì‚° */
(() => {
  const rc = document.getElementById('recommand');
  if (!rc) return;

  const mo = new MutationObserver(() => {
    renderProgressTicksFromAskWraps();
    updateProgressFromAskWraps();
  });
  mo.observe(rc, { childList: true, subtree: false });

  // ì´ˆê¸° 1íšŒ
  renderProgressTicksFromAskWraps();
  updateProgressFromAskWraps();
})();

// ìì‹ html (studio1.html ê°™ì€ íŒŒì¼) ì•ˆì˜ updateChipProgress() ëë¶€ë¶„ì— ì¶”ê°€
function updateChipProgress() {
  const total = document.querySelectorAll('#legend .chip, .kw-chip').length;
  const done  = document.querySelectorAll('#legend .chip.active, .kw-chip.active').length;

  const percent = total ? Math.round((done / total) * 100) : 0;

  const fill  = document.getElementById('chipProgress');
  const label = document.getElementById('chipPercent');

  if (fill)  fill.style.width = percent + '%';
  if (label) label.textContent = percent + '%';

  // ë¶€ëª¨(ë¶€ëª¨ íƒ­ì˜ ê²Œì´ì§€)ì—ê²Œ ì§„í–‰ë¥  ì „ë‹¬
  window.parent?.postMessage({
    type: 'IFRAME_STEP_PROGRESS',
    stepIndex: 1,   // ë¶€ëª¨ì˜ data-index="1" ë¸”ë¡(ì „ì²˜ë¦¬ ë‹¨ê³„)
    percent
  }, '*');
}


  
// })();

// ===== #signup3 í¼ â†” ë„ë„› ì—°ë™ (í¼ì´ ë“¤ì–´ìˆëŠ” ì¹´ë“œ ì•ˆì˜ ë„ë„›ë§Œ ë‹¤ì‹œ ê·¸ë¦¼) =====
// âœ… ì§„í–‰ë¥  ë°” ì—…ë°ì´íŠ¸ í•¨ìˆ˜
// âœ… ì¹© ê°œìˆ˜ ê¸°ë°˜ ì§„í–‰ë¥  (ì¶”ì²œDATA .chip + KW ì‹œíŠ¸ .kw-chip)
function updateChipProgress() {
  const total = document.querySelectorAll('#legend .chip, .kw-chip').length;
  const done  = document.querySelectorAll('#legend .chip.active, .kw-chip.active').length;

  const percent = total ? Math.round((done / total) * 100) : 0;

  const fill  = document.getElementById('chipProgress');
  const label = document.getElementById('chipPercent');

  if (fill)  fill.style.width = percent + '%';
  if (label) label.textContent = percent + '%';

  // (ì„ íƒ) ìƒë‹¨ ë‹¨ê³„ ê²Œì´ì§€ ìƒ‰ ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•˜ë©´ ìœ ì§€
  if (typeof renderGauge === 'function' && typeof currentStep !== 'undefined') {
    blockStates[currentStep] = (done===0) ? 'empty' : (done<total ? 'partial' : 'done');
    renderGauge();
  }
}


// âœ… ì¹© ì„ íƒ ì‹œ í”„ë¡œê·¸ë˜ìŠ¤ë°” ê°±ì‹ í•˜ë„ë¡ ìˆ˜ì •
function updateDonutProgressFromChips(){
  updateChipProgress();
}


// ì¶”ì²œDATA ì¹© í† ê¸€(ìœ„ì„)
document.addEventListener('click', (e)=>{
  const chip = e.target.closest('#legend .chip');
  if (!chip) return;

  const label = chip.textContent.trim();
  const item  = legendData.find(d => d.label === label);
  if (!item) return;

  item.selected = !item.selected;
  chip.classList.toggle('active', item.selected);

  updateChipProgress();   // âœ… ì§„í–‰ë¥  ê°±ì‹ 
});


(function setupRecommandInput() {
  const rc = document.getElementById("recommand");
  const input = document.getElementById("recommandInput");
  if (!rc || !input) return;

  input.addEventListener("change", () => {   // ì…ë ¥ ëë‚˜ê³  focus out
    addCollapseBelow(rc, input.value.trim());
  });

  input.addEventListener("keydown", (e) => { // ì—”í„° ëˆ„ë¥´ë©´ collapse ì¶”ê°€
    if (e.key === "Enter") {
      e.preventDefault();
      addCollapseBelow(rc, input.value.trim());
    }
  });

  function addCollapseBelow(container, text) {
    if (!text) return;

    // ê¸°ì¡´ collapse ìˆìœ¼ë©´ ì œê±°
    const oldCollapse = container.querySelector(".dynamic-collapse");
    if (oldCollapse) oldCollapse.remove();

    // collapse ìƒˆë¡œ ì¶”ê°€
    const collapseEl = document.createElement("div");
    collapseEl.className = "collapse dynamic-collapse";
    collapseEl.innerHTML = `
      <button class="collapse__btn" id="rc-btn" aria-expanded="false" aria-controls="rc-panel">
        ì…ë ¥ ê²°ê³¼ ë³´ê¸°
      </button>
      <div class="collapse__content" id="rc-panel" role="region" aria-labelledby="rc-btn">
        <p>ì…ë ¥í•œ ë‚´ìš©: <strong>${text}</strong></p>
        <p>ì—¬ê¸°ì— ì¶”ì²œ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì„¤ëª…ì´ë‚˜ ì˜µì…˜ì„ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </div>
    `;
    container.appendChild(collapseEl);

    // collapse í† ê¸€ ì´ë²¤íŠ¸
    const btn = collapseEl.querySelector(".collapse__btn");
    const panel = collapseEl.querySelector(".collapse__content");
    btn.addEventListener("click", () => {
      const willOpen = panel.classList.toggle("open");
      btn.setAttribute("aria-expanded", willOpen);
    });
  }
})();

// ë§ˆì§€ë§‰ input(5ë²ˆì§¸)ì—ì„œë§Œ confirm ì‹¤í–‰
document.addEventListener('input', (e) => {
  if (!e.target.matches('#recommand .recommend-input')) return;

  const rc = document.getElementById('recommand');
  if (!rc) return;

  const inputs = rc.querySelectorAll('.recommend-input');

  // ğŸ”¹ ë§ˆì§€ë§‰ input(ì˜ˆ: 5ë²ˆì§¸)
  if (inputs.length === 4) {
    const lastInput = inputs[inputs.length - 1];

    if (e.target === lastInput && lastInput.value.trim() !== '') {
      // ì´ë¯¸ ìƒì„±ëœ ë§í¬ê°€ ì—†ë‹¤ë©´ rcì˜ ë§¨ ì•„ë˜ì— ì¶”ê°€
      if (!rc.querySelector('.go-next-link')) {
        rc.insertAdjacentHTML("beforeend", `
          <div class="go-next-wrapper">
            <a href="/studio.html?step=2" target="_parent" class="go-next-link">
              ğŸ‘‰ 3stepìœ¼ë¡œ ì´ë™í•˜ê¸°
            </a>
          </div>
        `);
      }
    }
  }
});

function fitRecommandToViewport(){
  const el = document.getElementById('recommand');
  if (!el) return;

  const rect = el.getBoundingClientRect();
  const bottomGap = 16; // í•˜ë‹¨ ì—¬ìœ 
  const excelBar = document.getElementById('excelBar');
  const barH = (excelBar && excelBar.classList.contains('show'))
    ? excelBar.getBoundingClientRect().height + 12
    : 0;

  const avail = Math.max(200, window.innerHeight - rect.top - bottomGap - barH);
  el.style.setProperty('--rc-max-h', `${avail}px`);
}

// ìµœì´ˆ/ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ë°˜ì˜
window.addEventListener('load', fitRecommandToViewport);
window.addEventListener('resize', fitRecommandToViewport);

// #recommand ë‚´ë¶€ê°€ ë³€í•  ë•Œë„ ê°±ì‹ 
const rcEl = document.getElementById('recommand');
if (rcEl) {
  const mo = new MutationObserver(() => requestAnimationFrame(fitRecommandToViewport));
  mo.observe(rcEl, { childList:true, subtree:true });
}

// ask-wrap ì¶”ê°€/ì •ë ¬ ë“± ì£¼ìš” í•¨ìˆ˜ ë’¤ì—ë„ í˜¸ì¶œ(ì •ì˜ë¼ ìˆìœ¼ë©´ ë®ì–´ì”Œì›Œ í›… ì—°ê²°)
['addAskWrap','enableAskWrapDragSort','reindexAskWraps','buildSelectBoxes'].forEach(fn=>{
  if (typeof window[fn] === 'function') {
    const orig = window[fn];
    window[fn] = function(...args){
      const r = orig.apply(this, args);
      requestAnimationFrame(fitRecommandToViewport);
      return r;
    };
  }
});

// ask-wrap ì—´ê³  ë‹«ì„ ë•Œë„ ì¬ê³„ì‚°
document.addEventListener('click', (e)=>{
  if (e.target.closest('.ask-wrap')) {
    requestAnimationFrame(fitRecommandToViewport);
  }
});
// âœ… ask-wrap ì¶”ê°€ ê°ì‹œ â†’ data-idx="3"ì¸ ìš”ì†Œê°€ ìƒê¸°ë©´ ìµœì¢…í™•ì¸ aíƒœê·¸ ì¶”ê°€
(() => {
  const rc = document.getElementById('recommand');
  if (!rc) return;

  const observer = new MutationObserver(() => {
    const thirdWrap = rc.querySelector('.ask-wrap[data-idx="3"]');
    const choiceBtn = document.getElementById('choiceBtn');

    // ì¡°ê±´: data-idx="3"ì´ ì¡´ì¬í•˜ê³ , ì•„ì§ finalConfirmLinkê°€ ì—†ì„ ë•Œ
    if (thirdWrap && choiceBtn && !document.getElementById('finalConfirmLink')) {
      const a = document.createElement('a');
      a.id = 'finalConfirmLink';
      a.href = '#'; // í•„ìš” ì‹œ studio.html?step=2 ë¡œ ë°”ê¿”ë„ ë¨
      a.textContent = 'ìµœì¢…í™•ì¸';
      a.className = 'btn final-confirm';

      // choiceBtn ë°”ë¡œ ë’¤ì— ì‚½ì…
      choiceBtn.insertAdjacentElement('afterend', a);
    }
  });

  observer.observe(rc, { childList: true, subtree: true });
})();
document.addEventListener('click', (e) => {
  const link = e.target.closest('#finalConfirmLink');
  if (!link) return;

  e.preventDefault();

  // í”„ë¡œê·¸ë˜ìŠ¤ë°” 100%
  const fill  = document.getElementById('chipProgress');
  const label = document.getElementById('chipPercent');
  if (fill)  fill.style.width = '100%';
  if (label) label.textContent = '100%';

  // âœ… ìŠ¬ë¼ì´ë“œ ë¬¸êµ¬ êµì²´
  const slides = document.querySelectorAll('.slideshow-container .slide');
  if (slides.length > 0) {
    slides[0].textContent = "í•´ë‹¹ ë‹¨ê³„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•©ë‹ˆë‹¤.";   // ì²« ìŠ¬ë¼ì´ë“œì— ë¬¸êµ¬ ë°˜ì˜
    if (typeof currentSlide === 'function') currentSlide(1); // ì²« ìŠ¬ë¼ì´ë“œë¡œ ì´ë™
  }

  // 2ì´ˆ ë’¤ í™”ë©´ ì´ë™
  setTimeout(() => {
    parent.window.location.href = 'studio.html?step=2';
  }, 2000);
});


/* =================== ask-wrap ê°œìˆ˜ ê¸°ë°˜ í”„ë¡œê·¸ë˜ìŠ¤ (ìµœëŒ€ 80%) =================== */

// 1) í¼ì„¼íŠ¸ ê³„ì‚°: 1~4ê°œ â†’ 20,40,60,80 / 5ê°œ ì´ìƒ â†’ 80 * (4 / n) (ì ì  ê°ì†Œ)
function computeAskWrapPercent(n){
  if (!n) return 0;
  if (n <= 4) return n * 20;
  return Math.max(0, Math.round(80 * (4 / n))); // 5ê°œ=64, 6ê°œ=53, ...
}

// 2) ì‹¤ì œ ë°”/ë¼ë²¨/ë¶€ëª¨ê²Œì´ì§€ ì ìš©
function setAskWrapProgress(p){
  const pct = Math.max(0, Math.min(80, Math.round(p)));  // MAX 80%
  const fill  = document.getElementById('chipProgress');
  const label = document.getElementById('chipPercent');
  if (fill)  fill.style.width = pct + '%';
  if (label) label.textContent = pct + '%';

  // ë¶€ëª¨(1ë‹¨ê³„ ê²Œì´ì§€)ì—ë„ ë°˜ì˜
  try {
    window.parent?.postMessage({ type:'IFRAME_STEP_PROGRESS', stepIndex: 1, percent: pct }, '*');
  } catch (_) {}
}

// 3) ì¹´ìš´íŠ¸ â†’ ì§„í–‰ë¥  ë°˜ì˜
function updateProgressFromAskWrapCount(){
  const n = document.querySelectorAll('#recommand .ask-wrap').length || 0;
  setAskWrapProgress(computeAskWrapPercent(n));
}

// 4) ê¸°ì¡´ ë°©ë¬¸/ì…ë ¥ ê¸°ë°˜ í•¨ìˆ˜ ë®ì–´ì“°ê¸°(í˜¸ì¶œí•´ë„ ê²°ê³¼ëŠ” 'ê°œìˆ˜ ê¸°ì¤€'ìœ¼ë¡œ ê³„ì‚°ë¨)
window.updateProgressFromAskWraps = updateProgressFromAskWrapCount;

// 5) ìµœì´ˆ/ë³€ê²½ì‹œ ìë™ ê°±ì‹ 
document.addEventListener('DOMContentLoaded', updateProgressFromAskWrapCount);
(() => {
  const rc = document.getElementById('recommand');
  if (!rc) return;
  const mo = new MutationObserver(() => updateProgressFromAskWrapCount());
  mo.observe(rc, { childList: true, subtree: false });
})();

// 6) addAskWrap ì‹¤í–‰ í›„ì—ë„ ê°•ì œ ê°±ì‹  (í•¨ìˆ˜ ì¡´ì¬ ì‹œ ì•ˆì „í•˜ê²Œ ë˜í•‘)
if (typeof addAskWrap === 'function') {
  const _addAskWrap = addAskWrap;
  window.addAskWrap = function(...args){
    const r = _addAskWrap.apply(this, args);
    updateProgressFromAskWrapCount();
    return r;
  }
}
/* =================== ë¹ˆ ì…ë ¥ í•˜ì´ë¼ì´íŠ¸(ë‹¤ìˆ˜ ì…ë ¥ ì¤‘ í•˜ë‚˜ë¼ë„ ë¹„ë©´ invalid) =================== */
function isAskWrapInvalid(wrap){
  // í…ìŠ¤íŠ¸/ìˆ«ì ë“± ì¸ë¼ì¸ ì…ë ¥ë“¤
  const inputsAll = Array.from(wrap.querySelectorAll('.inline-input.bind-input, .recommend-input'));

  // optional í‘œì‹œê°€ ìˆëŠ” ì…ë ¥ì€ ì œì™¸í•˜ê³  ê²€ì‚¬í•˜ê³  ì‹¶ë‹¤ë©´: .optional ë˜ëŠ” data-optional ì‚¬ìš©
  const requiredInputs = inputsAll.filter(inp => !inp.classList.contains('optional') && !inp.hasAttribute('data-optional'));
  const targetInputs   = requiredInputs.length ? requiredInputs : inputsAll;

  // í•˜ë‚˜ë¼ë„ ë¹„ì–´ ìˆìœ¼ë©´ invalid
  const hasInputs = targetInputs.length > 0;
  const anyEmpty  = hasInputs && targetInputs.some(inp => inp.value.trim() === '');

  // ë¼ë””ì˜¤ ê·¸ë£¹ì€ ê·¸ë£¹ë³„ë¡œ í•˜ë‚˜ë¼ë„ ë¯¸ì„ íƒì´ë©´ invalid
  const radios  = Array.from(wrap.querySelectorAll('input[type="radio"]'));
  const groups  = [...new Set(radios.map(r => r.name))];
  const anyRadioGroupUnselected = radios.length > 0 && groups.some(name => {
    // CSS.escapeë¡œ name ì•ˆì „ ì²˜ë¦¬(íŠ¹ìˆ˜ë¬¸ì ëŒ€ë¹„)
    const sel = `input[type="radio"][name="${CSS.escape(name)}"]:checked`;
    return !wrap.querySelector(sel);
  });

  return (anyEmpty || anyRadioGroupUnselected);
}

// ì „ì²´ ask-wrap ê²€ì‚¬í•´ì„œ .invalid í† ê¸€
function validateAskWraps(){
  document.querySelectorAll('#recommand .ask-wrap').forEach(wrap=>{
    wrap.classList.toggle('invalid', isAskWrapInvalid(wrap));
  });
}

// ì´ë¯¸ ë‹¬ì•„ë‘” ì´ë²¤íŠ¸ê°€ ìˆë‹¤ë©´ ê·¸ëŒ€ë¡œ ìœ ì§€. ì—†ë‹¤ë©´ ì•„ë˜ ì •ë„ë§Œ ì¶”ê°€í•´ì£¼ë©´ ë¨:
document.addEventListener('DOMContentLoaded', validateAskWraps);
document.getElementById('recommand')?.addEventListener('input',  validateAskWraps);
document.getElementById('recommand')?.addEventListener('change', validateAskWraps);
(() => {
  const rc = document.getElementById('recommand');
  if (!rc) return;
  new MutationObserver(validateAskWraps).observe(rc, { childList:true, subtree:true });
})();
if (typeof addAskWrap === 'function'){
  const _add = addAskWrap;
  window.addAskWrap = function(...args){
    const r = _add.apply(this, args);
    validateAskWraps();
    return r;
  }
}

</script>
